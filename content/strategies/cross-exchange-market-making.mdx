---
title: Cross Exchange Market Making
description: Learn how to use cross exchange market making strategies
---

## For Traders

### How It Works

Cross exchange market making is described in [Strategies](/strategies/), with a further discussion in the Hummingbot [white paper](https://hummingbot.io/hummingbot.pdf).

> Warning "Updates to strategy" The cross exchange market making strategy has been updated as of v0.15.0, so that it will always place the order at the minimum profitability level. If the sell price for the specified volume on the taker exchange is 100, and you set the min_profitability as 0.01, it will place the maker buy order at 99. The top depth tolerance is also now specified by the user in base currency units. Please do not use old configuration files for running this strategy.

#### Schematic

The diagrams below illustrate how cross exchange market making works. The transaction involves two exchanges, a **taker exchange** and a **maker exchange**. Hummingbot uses the market levels available on the taker exchange to create bid and ask orders (act as a market maker) on the maker exchange (_Figure 1_).

<small>
  <center>
    ***Figure 1: Hummingbot acts as market maker on maker exchange***
  </center>
</small>

![Figure 1: Hummingbot acts as market maker on maker exchange](/assets/img/xemm-1.png)

**Buy order**: Hummingbot can sell the asset on the taker exchange for 99 (the best bid available); therefore, it places a buy order on the maker exchange at a lower value of 98.

**Sell order**: Hummingbot can buy the asset on the taker exchange for 101 (the best ask available), and therefore makes a sell order on the maker exchange for a higher price of 102.

<small>
  <center>
    ***Figure 2: Hummingbot fills an order on the maker exchanges and hedges on
    the taker exchange***
  </center>
</small>

![Figure 2: Hummingbot fills an order on the maker exchanges and hedges on the taker exchange](/assets/img/xemm-2.png)

If a buyer (_Buyer D_) fills Hummingbot's sell order on the maker exchange (_Figure 2_ ❶), Hummingbot immediately buys the asset on the taker exchange (_Figure 2_ ❷).

The end result: Hummingbot has sold the same asset at \$102 (❶) and purchased it for $101 (❷), for a profit of $1.

### Prerequisites

#### Inventory

1. For cross-exchange market making, you will need to hold inventory on two exchanges, one where the bot will make a market (the **maker exchange**) and another where the bot will source liquidity and hedge any filled orders (the **taker exchange**).

2. You will also need some Ethereum to pay gas for transactions on a DEX (if applicable).

Initially, we assume that the maker exchange is an Ethereum-based decentralized exchange and that the taker exchange is Binance.

#### Minimum Order Size

When placing orders on the maker market and filling orders on the taker market, the order amount should meet the exchange's minimum order size and minimum trade size.

You can find more information about this for each [Connector](https://docs.hummingbot.io/connectors/) under Miscellaneous section.

#### Adjusting Orders and Maker Price calculations

If the user has the following configuration,

order_amount: 1 ETH <br/>
min_profitability: 5 <br/>

and as per market conditions we have the following,

Sell price on Taker: 100 USDT (on a volume weighted average basis) <br/>
Top Bid price on Maker: 90 USDT (existing order on the order book, which is not the user's current order) <br/>

If `adjust_order_enabled` is set to `True`:
The bid price according to min profitability is 95 (100\*(1-0.05)). However as top bid price is 90, the strategy will place the bid order above the existing top bid at 90.01 USDT

If `adjust_order_enabled` is set to `False`:
The bid price according to min profitability is 95 (100\*(1-0.05)). Here the strategy will place the bid order at 95.

### Configuration Walkthrough

The following walks through all the steps when running `create` command.

| Parameter                     | Prompt                                                                                 | Definition                                                                                      |
| ----------------------------- | -------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------- |
| **maker_market**              | `Enter your maker exchange name`                                                       | The exchange where the bot will place maker orders.                                             |
| **taker_market**              | `Enter your taker exchange name`                                                       | The exchange where the bot will execute taker orders.                                           |
| **maker_market_trading_pair** | `Enter the token trading pair you would like to trade on maker market: [maker_market]` | Trading pair for the maker exchange.                                                            |
| **taker_market_trading_pair** | `Enter the token trading pair you would like to trade on taker market: [taker_market]` | Trading pair for the taker exchange.                                                            |
| **min_profitability**         | `What is the minimum profitability for you to make a trade?`                           | Minimum required profitability in order for Hummingbot to place an order on the maker exchange. |
| **order_amount**              | `What is the amount of [base_asset] per order? (minimum [min_amount])`                 | An amount expressed in base currency of maximum allowable order size.                           |

> Tip "Tip: Autocomplete inputs during configuration": When going through the command line config process, pressing `<TAB>` at a prompt will display valid available inputs.

### Advanced Parameters

The following parameters are fields in Hummingbot configuration files (located in the `/conf` folder, e.g. `conf/conf_xemm_[#].yml`).

| Term                                     | Definition                                                                                                                                                                                                                                                                                                                                                                             |
| ---------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **adjust_order_enabled**                 | If enabled, the strategy will place the order on top of the top bid and ask if it is more profitable to place it there. If disabled, the strategy will ignore the top of the maker order book for price calculations and only place the order based on taker price and min*profitability. Refer to Adjusting orders and maker price calculations section above. \_Default value: True* |
| **active_order_canceling**               | If enabled, Hummingbot will cancel orders that becomes unprofitable based on the `min_profitability` threshold. If disabled, Hummingbot will allow any outstanding orders to expire, unless `cancel_order_threshold` is reached.                                                                                                                                                       |
| **cancel_order_threshold**               | This parameter works when `active_order_canceling` is disabled. If the profitability of an order falls below this threshold, Hummingbot will cancel an existing order and place a new one, if possible. This allows the bot to cancel orders when paying gas to cancel (if applicable) is a better than incurring the potential loss of the trade.                                     |
| **limit_order_min_expiration**           | An amount in seconds, which is the minimum duration for any placed limit orders.                                                                                                                                                                                                                                                                                                       |
| **top_depth_tolerance**                  | An amount expressed in base currency which is used for getting the top bid and ask, ignoring dust orders on top of the order book.<br/><br/>_Example: If you have a top depth tolerance of `0.01 ETH`, then while calculating the top bid, you exclude orders starting from the top until the sum of orders excluded reaches `0.01 ETH`._                                              |
| **anti_hysteresis_duration**             | An amount in seconds, which is the minimum amount of time interval between adjusting limit order prices.                                                                                                                                                                                                                                                                               |
| **order_size_taker_volume_factor**       | Specifies the percentage of hedge-able volume on taker side which will be considered for calculating the market making price.                                                                                                                                                                                                                                                          |
| **order_size_taker_balance_factor**      | Specifies the percentage of asset balance to be used for hedging the trade on taker side.                                                                                                                                                                                                                                                                                              |
| **order_size_portfolio_ratio_limit**     | Specifies the ratio of total portfolio value on both maker and taker markets to be used for calculating the order size if order_amount is not specified.                                                                                                                                                                                                                               |
| **taker_to_maker_base_conversion_rate**  | Specifies conversion rate for taker base asset value to maker base asset value.                                                                                                                                                                                                                                                                                                        |
| **taker_to_maker_quote_conversion_rate** | Specifies conversion rate for taker quote asset value to maker quote asset value.                                                                                                                                                                                                                                                                                                      |

### Exchange Rate Conversion

From past versions of Hummingbot it uses [CoinGecko](https://www.coingecko.com/en/api) and [CoinCap](https://docs.coincap.io/?version=latest) public APIs to fetch asset prices. However, this dependency caused issues for users when those APIs were unavailable. Starting on version [0.28.0](/release-notes/0.28.0/#removed-dependency-on-external-data-feeds), Hummingbot uses exchange order books to perform necessary conversions rather than data feeds.

When you run strategies on multiple exchanges, there may be instances where you need to utilize an exchange rate to convert between assets.

In particular, you may need to convert the value of one stablecoin to another when you use different stablecoins in multi-legged strategy like [cross-exchange market making](/strategies/cross-exchange-market-making/).

For example, if you make a market in the WETH/DAI pair on a decentralized exchange, you may want to hedge filled orders using the ETH-USDT pair on Binance. Using exchange rates for USDT and DAI against ETH allows Hummingbot to take into account differences in prices.

```
maker_market: bamboo_relay
taker_market: binance
maker_market_trading_pair: WETH-DAI
taker_market_trading_pair: ETH-USDT
taker_to_maker_base_conversion_rate: 1
taker_to_maker_quote_conversion_rate: 1
```

By default, taker to maker base conversion rate and taker to maker quote conversion rate value are both `1`.

Our maker base asset is WETH and taker is ETH. 1 WETH is worth 0.99 ETH (1 / 0.99) so we will set the `taker_to_maker_base_conversion_rate` value to 1.01.

While our maker quote asset is DAI, taker is USDT and 1 DAI is worth 1.01 USDT (1 / 1.01). similar to the calculation we did for the base asset. In this case, we will set the `taker_to_maker_quote_conversion_rate` to 0.99.

To configure a parameter value without going through the prompts, input command as `config [ key ] [ value ]`. These can be reconfigured without stopping the bot however, it will only take effect after restarting the strategy.

```
config taker_to_maker_base_conversion_rate 1.01
config taker_to_maker_quote_conversion_rate 0.99
```

## For Developers

### Architecture

The cross exchange market making strategy performs market making trades between two markets: it emits limit orders to a less liquid, larger spread market; and emits market orders on a more liquid, smaller spread market whenever the limit orders were hit. This, in effect, sends the liquidity from the more liquid market to the less liquid market.

In Hummingbot code and documentation, we usually refer to the less liquid market as the "maker side" - since the cross exchange market making strategy is providing liquidity there. We then refer to the more liquid market as the "taker side" - since the strategy is taking liquidity there.

The cross exchange market making strategy's code is divided into two major parts:

1.  Order creation and adjustment

    Periodically creates and adjusts limit orders on the maker side.

2.  Hedging order fills

    Performs the opposite, hedging trade on the taker side, whenever a maker order has been filled.

### Order Creation and Adjustment

Here's a high-level view of the logical flow of the order creation and adjustment part. The overall logic of order creation and adjustment is pretty involved, but it can be roughly divided to the **Cancel Order Flow** and the **Create Order Flow**.

The cross exchange market making strategy regularly refreshes the limit orders it has on the maker side market by regularly cancelling old orders (or waiting for existing order to expire), and creating new limit orders. This process ensures the limit orders it has on the maker side are always of the correct and profitable prices.

![Figure 1: Order creation and adjustment flow chart](xemm-flowchart-1.svg)

The entry point of this logic flow is the `c_process_market_pair()` function in [`cross_exchange_market_making.pyx`](https://github.com/CoinAlpha/hummingbot/blob/master/hummingbot/strategy/cross_exchange_market_making/cross_exchange_market_making.pyx).

### Cancel Order Flow

The cancel order flow regularly monitors all active limit orders on the maker side, to ensure they are all valid and profitable over time. If any active limit order becomes invalid (e.g. because the asset balance changed) or becomes unprofitable (due to market price changes), then it should cancel such orders.

![Figure 2: Cancel order flow chart](xemm-flowchart-2.svg)

#### Active order cancellation setting

The [`active_order_canceling`](/strategies/cross-exchange-market-making/) setting changes how the cancel order flow operates. `active_order_canceling` should be enabled when the maker side is a centralized exchange (e.g. Binance, Coinbase Pro), and it should be disabled when the maker side is a decentralized exchange.

When `active_order_canceling` is enabled, the cross exchange market making strategy would refresh orders by actively cancelling them regularly. This is optimal for centralized exchanges because it allows the strategy to respond quickly when, for example, market prices have significantly changed. This should not be chosen for decentralized exchanges that charge gas for cancelling orders (such as Radar Relay).

When `active_order_canceling` is disabled, the cross exchange market making strategy would emit limit orders that automatically expire after a predefined time period. This means the strategy can just wait for them to expire to refresh the maker orders, rather than having to cancel them actively. This is useful for decentralized exchanges because it avoids the potentially very long cancellation delays there, and it also does not cost any gas to wait for order expiration.

It is still possible for the strategy to actively cancel orders with `active_order_canceling` disabled, via the [`cancel_order_threshold`](/strategies/cross-exchange-market-making/) setting. For example, you can set it to -0.05 such that the strategy would still cancel a limit order on a DEX when it's profitability dropped below -5%. This can be used as a safety switch to guard against sudden and large price changes on decentralized exchanges.

#### Is hedging profitable?

Assuming active order canceling is enabled, the first check the strategy does with each active maker order is whether it is still profitable or not. The current profitability of an order is calculated assuming the order is filled and hedged on the taker market immediately.

If the profit ratio calculated for the maker order is less than the [`min_profitability`](/strategies/cross-exchange-market-making/) setting, then the order is canceled.

The logic of this check can be found in the function `c_check_if_still_profitable()` in [`cross_exchange_market_making.pyx`](https://github.com/CoinAlpha/hummingbot/blob/master/hummingbot/strategy/cross_exchange_market_making/cross_exchange_market_making.pyx).

Otherwise, the strategy will go onto the next check.

#### Is there sufficient account balance?

The next check afterwards checks whether there's enough asset balance left to satisfy the maker order. If there is not enough balance left on the exchange, the order would be cancelled.

The logic of this check can be found in the function `c_check_if_sufficient_balance()` in [`cross_exchange_market_making.pyx`](https://github.com/CoinAlpha/hummingbot/blob/master/hummingbot/strategy/cross_exchange_market_making/cross_exchange_market_making.pyx).

Otherwise, the strategy will go onto the next check.

#### Is the price correct?

Asset prices on both the maker side and taker side are always changing, and thus the optimal prices for the limit orders on the maker side would change over time as well.

The cross exchange market making strategy calculates the optimal pricing from the following factors:

1.  Current market order prices on the taker side.
2.  Current order book depth on the maker side.
3.  [`top_depth_tolerance`](/strategies/cross-exchange-market-making/) setting, which is applied to the order book depths on maker side.
4.  [`min_profitability`](/strategies/cross-exchange-market-making/) setting, which is applied to the market order prices on the taker side.

If the price of the active order is different from the optimal price calculated, then the order would be cancelled. Otherwise, the strategy would allow the order to stay.

The logic of this check can be found in the function `c_check_if_price_correct()` in [`cross_exchange_market_making.pyx`](https://github.com/CoinAlpha/hummingbot/blob/master/hummingbot/strategy/cross_exchange_market_making/cross_exchange_market_making.pyx).

After all the active orders on make side have been checked, the strategy will proceed to the create order flow.

### Create Order Flow

After going through the cancel order flow, the cross exchange market making strategy would check and re-create any missing limit orders on the maker side.

![Figure 3: Cancel order flow chart](xemm-flowchart-3.svg)

The logic inside the create order flow is relatively straightforward. It checks whether there are existing bid and ask orders on the maker side. If any of the orders are missing, it will check whether it is profitable to create one at the moment. If it's profitable to create the missing orders, it will calculate the optimal pricing and size and create those orders.

The logic of the create order flow can be found in the function `c_check_and_create_new_orders()` in [`cross_exchange_market_making.pyx`](https://github.com/CoinAlpha/hummingbot/blob/master/hummingbot/strategy/cross_exchange_market_making/cross_exchange_market_making.pyx).

### Hedging Order Fills

The cross exchange market making strategy would always immediately hedge any order fills from the maker side, regardless of how profitable the hedge is at the moment. The rationale is, it is more useful to minimize unnecessary exposure to further market risks for the users, than to wait speculatively for a profitable moment to hedge the maker order fill - which may never come.

![Figure 4: Hedging order fills flow chart](xemm-flowchart-4.svg)

The logic of the hedging order fill flow can be found in the function `c_did_fill_order()` and `c_check_and_hedge_orders()` in [`cross_exchange_market_making.pyx`](https://github.com/CoinAlpha/hummingbot/blob/master/hummingbot/strategy/cross_exchange_market_making/cross_exchange_market_making.pyx).
