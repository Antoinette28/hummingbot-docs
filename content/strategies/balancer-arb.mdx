---
title: Balancer Arbitrage
description: Learn how to use Balancer arbitrage strategy
---

import { MultiCodeBlock } from "gatsby-theme-apollo-docs";

**Updated as of v0.33**

Before you can use the Balancer arbitrage strategy in Hummingbot, you need to install and configure the Gateway API server. The following flowchart shows the typical installaton and configuration process for Balancer.

![Balancer flowchart](/img/balancer-flowchart.png)

## Prerequisites

You need to setup an Ethererum wallet and nodes(Infura), and Defipulse API keys for gas estimation.

> **Note:** You can manually set the gas limit but we recommend to use Defipulse API keys for providing the efficent rate of gas estimation.

### Setup Ethereum wallet and nodes

Ensure you have setup the Ethereum wallet and nodes, for more details:

- see [Setup Ethereum Wallet](https://docs.hummingbot.io/operation/adv-command-ref/#setup-ethereum-wallet)
- see [Setup Infura Node](https://docs.hummingbot.io/operation/adv-command-ref/#option-1-infura). Take note of the Ethereum RPC URL to be use later for Gateway Docker settings.

### (Optional) Create Defipulse API key

1. Create a free account on [defipulse](https://data.defipulse.com/signup).
2. After you verify your account, take note of the API Key to be use later for Gateway settings in Hummingbot.

![defipulse](/img/defipulse.png)

## Installation and Configuration

The following sections describes the insstallation and configuration process for Balancer.

### Create SSL Cert in Hummingbot

1. Start Hummingbot.
2. Enter `generate_certs` to create the SSL cert. The following prompt is displayed.

   ```
    >>>  generate_certs
    -----------------------------------------------------------
    Enter passphrase to generate Gateway SSL certification >>>
   ```

3. Enter a passphrase.

> **Note:**

    - It is recommended not to use the same password as the Hummingbot instance.
    - Take note of the passphrase and cert path to be use later for Gateway Docker settings.

> **Tip:** To get the cert path, run `pwd` from the `certs' directory where Hummingbot is installed to get the absolute path.

### Install Gateway Docker

1. Run the following command:

```

# 1) Download Hummingbot Gateway install

curl https://raw.githubusercontent.com/CoinAlpha/hummingbot/amm_arb_n_connectors/installation/docker-commands/create-gateway.sh -o create-gateway.sh
curl https://raw.githubusercontent.com/CoinAlpha/hummingbot/amm_arb_n_connectors/installation/docker-commands/update-gateway.sh -o update-gateway.sh

# 2) Enable script permissions

chmod a+x \*.sh

# 3) Create a gateway instance

./create-gateway.sh

```

2.  After Gateway has been installed, the **CREATE A NEW GATEWAY INSTANCE** prompt is displayed. Follow the onscreen instructions to enter the required values.
    > **Note:** Ensure you have cert passphrase, cert path, and Ethereum RPC URL before proceeding. Else, see [Prerequisites](/strategies/balancer-arb/#prerequisites) for more details
    > The following screenshot displays an example of the completed information.

![Gateway](/img/gateway.png) 3. The Gateway configuration summary is displayed. Review the information and enter yes to complete the Gateway configuration.
![Gateway](/img/gateway-summary.png)

> **Note:** By default, Gateway will install on port `5000` which Hummingbot will connect to. If the port `5000 is not available, Gateway will find the next port number. Take note of the Gateway port number to be use later in the Gateway settings in Hummingbot.

If your Gateway instance is installed on `5000`, Hummingbot should be able to connect to it. Otherwise, you need to set the correct port through the configuration.

### (Optional) Configure Gateway settings in Hummingbot

There are two optional settings that you can set for the Gateway:

- If your port number is not `5000`, you can set the correct port in Hummingbot.

1. Access Hummingbot.
2. Enter `config gateway_api_port` to create the SSL cert. The following prompt is displayed.

```

  >>>  config gateway_api_port
  Please follow the prompt to complete configurations:
  -----------------------------------------------------------
  Please enter your Gateway API port >>>

```

3. Enter the port number.

- If you want to use and configure defipulse as the gas estimator

  1. Access Hummingbot.
  2. Enter `config ethgasstation_gas_enabled`, and enter `True`
  3. Enter `config ethgasstation_api_key`, and enter the Defipulse API key.
  4. Enter `config ethgasstation_gas_level`, and the following prompt is displayed:
     ```
     Enter gas level you want to use for Ethererum transcations (fast, fastest, safeLow, average) >>>
     ```
     **Note:** For caculation details on the various gas level, see [defipulse docs](https://docs.defipulse.com/api-docs-by-provider/egs/gas-price)
  5. Enter the value for the gas level.
  6. (Optional) Enter `config ethgasstation_refresh_time`, enter a value to overwrite the default Gas Station refresh time (120secs).

## AMM Arbitrage Strategy

After the installation and configuration is completed, we can create the configuration for AMM arbitrage strategy.

1. In Hummingbot, enter `create`.
2. Enter `amm-arb`.
3. Enter `balancer`.
4. Enter a trading pair, for example `BAT-DAI`. **Note:** Ensure the trading pair tokens are in your wallet in order to trade.
5. Enter an exchange connector, for example `binance`.
6. Follow on-screen prompts and info for AMM arb parameters. See following prompt example:

```
  template_version: 1
  strategy: amm_arb

  # The following configuations are only required for the AMM arbitrage trading strategy

  # Connectors and markets parameters
  connector_1: balancer
  market_1: BAT-DAI
  connector_2: binance
  market_2: BAT-USDT

  order_amount: 0.1

  # Minimum profitability target required to place an order
  # Expressed in percentage value, e.g. 1 = 1% target profit
  min_profitability: 1.0

  # A buffer for which to adjust order price for higher chance of the order getting filled.
  # This is important for AMM which transaction takes a long time where a slippage is acceptable rather having
  # the transaction get rejected. The submitted order price will be adjust higher (by percentage value) for buy order
  # and lower for sell order. (Enter 1 for 1%)
  market_1_slippage_buffer: 0.5

  # A buffer to add to the price to account for slippage when buying/selling on second connector market
  # (Enter 1 for 1%)
  market_2_slippage_buffer: 0.5

  # A flag (true/false), if true the bot submits both arbitrage taker orders (buy and sell) simultaneously
  # If false, the bot will wait for first exchange order filled before submitting the other order
  concurrent_orders_submission: false
```

7. (Recommended) Enter `paper_trade_mode` to run paper trading first.
8. Enter `start` to run the strategy.

## Update Gateway Docker

To update the docker container, run the `[update-gateway.sh](http://update-gateway.sh)` script and and follow the prompt instructions. The update script allows you to stop and delete the running instance, and update the docker image if it is not the latest. Upon completion, it will automatically execute the create-gateway.sh script to create a new Gateway container instance.

## Switch Balancer Network

Two ways to switch network(Kovan/Mainnet)

- Delete the Gateway docker container and re-run the `[create-gateway.sh](http://create-gateway.sh)` script.
- Use `[update-gateway.sh](http://update-gateway.sh)` script to update the docker image and follow the prompt instructions.
